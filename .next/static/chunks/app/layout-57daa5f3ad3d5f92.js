(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3185],{30579:function(e,t,r){Promise.resolve().then(r.t.bind(r,47960,23)),Promise.resolve().then(r.bind(r,46281))},46281:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return c}});var o=r(57437),a=r(2265),n=r(29116);let s=(0,a.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[c,i]=(0,a.useState)(null),[u,g]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=localStorage.getItem("accessToken"),t=localStorage.getItem("user"),r=localStorage.getItem("tenant");e&&t&&r&&(l(JSON.parse(t)),i(JSON.parse(r))),g(!1)},[]);let h=async(e,t)=>{try{let{user:r,tenant:o,tokens:a}=(await n.Z.post("/api/auth/login",{email:e,password:t})).data;localStorage.setItem("accessToken",a.accessToken),localStorage.setItem("refreshToken",a.refreshToken),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("tenant",JSON.stringify(o)),l(r),i(o)}catch(e){var r,o;throw Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.error)||"Login failed")}},d=async(e,t,r,o)=>{try{let{user:a,tenant:s,tokens:c}=(await n.Z.post("/api/auth/register",{tenantName:e,tenantSlug:t,email:r,password:o})).data;localStorage.setItem("accessToken",c.accessToken),localStorage.setItem("refreshToken",c.refreshToken),localStorage.setItem("user",JSON.stringify(a)),localStorage.setItem("tenant",JSON.stringify(s)),l(a),i(s)}catch(e){var a,s;throw Error((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.error)||"Registration failed")}};return(0,o.jsx)(s.Provider,{value:{user:r,tenant:c,login:h,register:d,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("tenant"),l(null),i(null)},loading:u},children:t})}function c(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},29116:function(e,t,r){"use strict";var o=r(83464);let a=r(40257).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",n=o.Z.create({baseURL:a,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),t.Z=n},47960:function(){}},function(e){e.O(0,[3587,3464,2971,2117,1744],function(){return e(e.s=30579)}),_N_E=e.O()}]);