(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3219],{56132:function(e,t,s){Promise.resolve().then(s.bind(s,65733))},65733:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var a=s(57437),r=s(10849),n=s(2265),o=s(99376);function l(e){let{padding:t=16,background:s="#ffffff",children:n}=e,{connectors:{connect:o,drag:l},selected:c}=(0,r.Zo)(e=>({selected:e.events.selected}));return(0,a.jsx)("div",{ref:e=>e&&o(l(e)),style:{padding:t,background:s},className:"rounded-xl border border-slate-200 ".concat(c?"ring-2 ring-slate-500":""),children:n})}function c(e){let{text:t="Edit me",color:s="#0f172a",fontSize:o=18,align:l="left"}=e,{connectors:{connect:c,drag:i},selected:d,actions:{setProp:u}}=(0,r.Zo)(e=>({selected:e.events.selected})),[g,h]=(0,n.useState)(t);return(0,a.jsx)("div",{ref:e=>e&&c(i(e)),className:"relative ".concat(d?"ring-2 ring-slate-500":""),contentEditable:!0,onBlur:()=>{u(e=>{e.text=g})},onInput:e=>h(e.target.innerText),style:{color:s,fontSize:o,textAlign:l},suppressContentEditableWarning:!0,children:g})}function i(e){let{label:t="Button",href:s="#"}=e,{connectors:{connect:n,drag:o},selected:l}=(0,r.Zo)(e=>({selected:e.events.selected}));return(0,a.jsx)("a",{ref:e=>e&&n(o(e)),className:"inline-flex items-center justify-center rounded-lg bg-slate-900 px-5 py-3 text-sm font-semibold text-white shadow transition hover:bg-slate-700 ".concat(l?"ring-2 ring-slate-500":""),href:s,children:t})}l.craft={props:{padding:32,background:"#ffffff"},related:{}},c.craft={props:{text:"Start typing...?",color:"#0f172a",fontSize:20,align:"left"}},i.craft={props:{label:"Call to Action",href:"#"}};var d=s(33145);function u(e){let{src:t="https://images.unsplash.com/photo-1522202176988-66273c2fd55f",alt:s="Placeholder",width:n=600,height:o=400}=e,{connectors:{connect:l,drag:c},selected:i}=(0,r.Zo)(e=>({selected:e.events.selected}));return(0,a.jsx)("div",{ref:e=>e&&l(c(e)),className:"overflow-hidden rounded-xl border border-slate-200 ".concat(i?"ring-2 ring-slate-500":""),children:(0,a.jsx)(d.default,{alt:s,height:o,src:t,width:n})})}function g(){let{connectors:e}=(0,r.jE)();return(0,a.jsxs)("div",{className:"space-y-3 p-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Components"}),(0,a.jsx)("div",{ref:t=>e.create(t,(0,a.jsx)(l,{})),className:"w-full rounded border border-slate-300 bg-white px-3 py-2 text-left text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer",children:"Container"}),(0,a.jsx)("div",{ref:t=>e.create(t,(0,a.jsx)(c,{})),className:"w-full rounded border border-slate-300 bg-white px-3 py-2 text-left text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer",children:"Text"}),(0,a.jsx)("div",{ref:t=>e.create(t,(0,a.jsx)(i,{})),className:"w-full rounded border border-slate-300 bg-white px-3 py-2 text-left text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer",children:"Button"}),(0,a.jsx)("div",{ref:t=>e.create(t,(0,a.jsx)(u,{})),className:"w-full rounded border border-slate-300 bg-white px-3 py-2 text-left text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer",children:"Image"})]})}function h(){let{actions:e,selected:t}=(0,r.jE)(e=>{let[t]=e.events.selected;return{selected:t?e.nodes[t]:null}}),[s,o]=(0,n.useState)({});if((0,n.useEffect)(()=>{var e;if(!t){o({});return}o(null!==(e=t.data.props)&&void 0!==e?e:{})},[t]),!t)return(0,a.jsx)("div",{className:"p-4 text-sm text-slate-500",children:"Select a component to edit its properties."});let l=(s,a)=>{o(e=>({...e,[s]:a})),e.setProp(t.id,e=>{e[s]=a})};return(0,a.jsxs)("div",{className:"space-y-4 p-4 text-sm",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Settings"}),Object.entries(s).map(e=>{let[t,s]=e;return(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"text-xs uppercase tracking-wide text-slate-500",children:t}),(0,a.jsx)("input",{className:"mt-1 w-full rounded border border-slate-300 px-2 py-1",value:String(null!=s?s:""),onChange:e=>l(t,e.target.value)})]},t)})]})}function x(e){let{children:t}=e,{enabled:s}=(0,r.jE)(e=>({enabled:e.options.enabled}));return(0,a.jsx)("div",{className:"flex min-h-screen justify-center bg-slate-100 p-10",children:(0,a.jsx)("div",{className:"w-full max-w-4xl rounded-2xl bg-white p-10 shadow ".concat(s?"cursor-grab":""),children:t})})}u.craft={props:{src:"https://images.unsplash.com/photo-1522202176988-66273c2fd55f",alt:"Default image",width:600,height:400}};var f=s(46281),m=s(29116);class p{static async getPages(e){return(await m.Z.get("/api/websites/".concat(e,"/pages"))).data.pages}static async getPage(e,t){return(await m.Z.get("/api/websites/".concat(e,"/pages/").concat(t))).data.page}static async createPage(e,t){return(await m.Z.post("/api/websites/".concat(e,"/pages"),t)).data.page}static async updatePage(e,t,s){return(await m.Z.put("/api/websites/".concat(e,"/pages/").concat(t),s)).data.page}static async publishPage(e,t){await m.Z.post("/api/websites/".concat(e,"/pages/").concat(t,"/publish"))}static async deletePage(e,t){await m.Z.delete("/api/websites/".concat(e,"/pages/").concat(t))}}var b=s(32660),v=s(82431),j=s(83229);function y(){let{user:e}=(0,f.a)(),t=(0,o.useSearchParams)(),s=(0,o.useRouter)(),n=null==t?void 0:t.get("website"),d=(null==t?void 0:t.get("page"))||"home";return(0,a.jsx)("div",{className:"flex h-screen flex-col overflow-hidden bg-slate-100",children:(0,a.jsxs)(r.ML,{resolver:{Container:l,Text:c,Button:i,ImageBlock:u},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white border-b shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("button",{onClick:()=>{s.push("/dashboard")},className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Back to Dashboard"})]}),(0,a.jsx)("div",{className:"h-6 border-l border-gray-300"}),(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:n?"Editing Website":"Demo Editor"}),!n&&(0,a.jsx)("span",{className:"text-sm text-amber-600 bg-amber-50 px-2 py-1 rounded-md",children:"Demo Mode - Changes saved locally"})]}),(0,a.jsx)(w,{websiteId:n||void 0,slug:d})]}),(0,a.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,a.jsx)("aside",{className:"w-72 border-r bg-white shadow-sm",children:(0,a.jsx)(g,{})}),(0,a.jsx)("main",{className:"flex-1 overflow-auto bg-gray-50",children:(0,a.jsx)(x,{children:(0,a.jsx)(r.RQ,{children:(0,a.jsxs)(r.W_,{is:l,canvas:!0,padding:32,children:[(0,a.jsx)(c,{text:"Welcome to the Website Builder!"}),(0,a.jsx)(c,{text:"Drag components from the left panel to build your page",fontSize:14}),(0,a.jsx)(i,{label:"Get Started"})]})})})}),(0,a.jsx)("aside",{className:"w-80 border-l bg-white shadow-sm",children:(0,a.jsx)(h,{})})]})]})})}function w(e){let{websiteId:t,slug:s}=e,{query:o,actions:l}=(0,r.jE)((e,t)=>({enabled:e.options.enabled,canUndo:t.history.canUndo(),canRedo:t.history.canRedo()})),{page:c,savePage:i}=function(e,t){let[s,a]=(0,n.useState)(null),[r,o]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null),i=async()=>{if(e&&t){o(!0),c(null);try{let s=await p.getPage(e,t);a(s)}catch(e){c(e.message)}finally{o(!1)}}};(0,n.useEffect)(()=>{i()},[e,t]);let d=async r=>{if(s)try{let s=await p.updatePage(e,t,{content:r});return a(s),s}catch(e){throw c(e.message),e}};return{page:s,loading:r,error:l,savePage:d,refetch:i}}(t||"demo",s||"home"),[d,u]=(0,n.useState)(!1),[g,h]=(0,n.useState)(!1),x=async()=>{u(!0);try{let e=o.serialize();t&&s?await i(JSON.parse(e)):localStorage.setItem("demo-page-content",e),h(!0),setTimeout(()=>h(!1),2e3)}catch(e){console.error("Save failed:",e)}finally{u(!1)}},f=()=>{if(null==c?void 0:c.content){let e="string"==typeof c.content?c.content:JSON.stringify(c.content);l.deserialize(e)}else{let e=localStorage.getItem("demo-page-content");e&&l.deserialize(e)}};return(0,n.useEffect)(()=>{(null==c?void 0:c.content)&&f()},[null==c?void 0:c.content]),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>l.history.undo(),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!o.history.canUndo(),children:"Undo"}),(0,a.jsx)("button",{onClick:()=>l.history.redo(),className:"px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",disabled:!o.history.canRedo(),children:"Redo"}),(0,a.jsxs)("button",{onClick:f,className:"flex items-center space-x-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:[(0,a.jsx)(v.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:"Load"})]}),(0,a.jsxs)("button",{onClick:x,disabled:d,className:"flex items-center space-x-1 px-4 py-1.5 text-sm rounded-md text-white transition-colors ".concat(g?"bg-green-600":d?"bg-gray-400":"bg-blue-600 hover:bg-blue-700"),children:[(0,a.jsx)(j.Z,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:g?"Saved!":d?"Saving...":"Save"})]})]})}function N(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center h-screen",children:"Loading editor..."}),children:(0,a.jsx)(y,{})})}},46281:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return l},a:function(){return c}});var a=s(57437),r=s(2265),n=s(29116);let o=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null),[c,i]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{let e=localStorage.getItem("accessToken"),t=localStorage.getItem("user"),s=localStorage.getItem("tenant");e&&t&&s&&(l(JSON.parse(t)),i(JSON.parse(s))),u(!1)},[]);let g=async(e,t)=>{try{let{user:s,tenant:a,tokens:r}=(await n.Z.post("/api/auth/login",{email:e,password:t})).data;localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken),localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("tenant",JSON.stringify(a)),l(s),i(a)}catch(e){var s,a;throw Error((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Login failed")}},h=async(e,t,s,a)=>{try{let{user:r,tenant:o,tokens:c}=(await n.Z.post("/api/auth/register",{tenantName:e,tenantSlug:t,email:s,password:a})).data;localStorage.setItem("accessToken",c.accessToken),localStorage.setItem("refreshToken",c.refreshToken),localStorage.setItem("user",JSON.stringify(r)),localStorage.setItem("tenant",JSON.stringify(o)),l(r),i(o)}catch(e){var r,o;throw Error((null===(o=e.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.error)||"Registration failed")}};return(0,a.jsx)(o.Provider,{value:{user:s,tenant:c,login:g,register:h,logout:()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),localStorage.removeItem("tenant"),l(null),i(null)},loading:d},children:t})}function c(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},29116:function(e,t,s){"use strict";var a=s(83464);let r=s(40257).env.NEXT_PUBLIC_API_URL||"http://localhost:3001",n=a.Z.create({baseURL:r,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&(e.headers.Authorization="Bearer ".concat(t))}return e}),t.Z=n}},function(e){e.O(0,[3464,849,7452,2971,2117,1744],function(){return e(e.s=56132)}),_N_E=e.O()}]);